!function(){var e=window.calendar,n={leapMonth:e.leapMonth,lunarMonthDays:e.monthDays,toSolar:function(n,a,t){var l=this.leapMonth(n),r=!1;l+1==a&&(r=!0),l&&a>l&&--a;var u=e.lunar2solar(n,a,t,r);return[u.cYear,u.cMonth,u.cDay]},toLunar:function(n,a,t){var l,r=e.solar2lunar(n,a,t),u=this.leapMonth(r.lYear);return l=u&&(r.lMonth>u||r.isLeap)?r.lMonth+1:r.lMonth,[r.lYear,l,r.lDay]}},a=function(e){function a(e){d=v?x.fn_Y():m.fn_Y(),h=v?x.fn_M(f[0]):m.fn_M(o[0]),_=v?x.fn_D(f[0],f[1]):m.fn_D(o[0],o[1]),M&&(M.refillColumn(0,d),M.refillColumn(1,h),M.refillColumn(2,_)),e&&e()}function t(e,n){var a=JSON.parse(n),t=[];return t[0]=a[0][e[0]].value,t[1]=a[1][e[1]].value,t[2]=a[2][e[2]].value,t}function l(e){var n=JSON.stringify(e.data),a=t(e.selectedIndex,n);if(p[0]!=a[0]){var l=v?x.fn_M(a[0]):m.fn_M(a[0]);M.refillColumn(1,l);var r=v?x.fn_D(a[0],a[1]):m.fn_D(a[0],a[1]);M.refillColumn(2,r)}else if(p[1]!=a[1]){var r=v?x.fn_D(a[0],a[1]):m.fn_D(a[0],a[1]);M.refillColumn(2,r)}p=a}function r(e,n){var l=JSON.stringify(e.data);t(e.selectedIndex,l);a(n)}function u(e,n){function a(){for(var n=M.data,a=0;a<n[2].length;a++){n[2][a].value==e[2]&&(M.scrollColumn(2,a),M.selectedIndex[2]=a)}}for(var l,r=M.data,u=0;u<r[0].length;u++){if(r[0][u].value==e[0]){M.scrollColumn(0,u),M.selectedIndex[0]=u;var i=JSON.stringify(M.data);l=t(M.selectedIndex,i);var o=v?x.fn_M(l[0]):m.fn_M(l[0]);M.refillColumn(1,o),function(){for(var n=M.data,r=0;r<n[1].length;r++)if(n[1][r].value==e[1]){M.scrollColumn(1,r),M.selectedIndex[1]=r;var u=JSON.stringify(M.data);l=t(M.selectedIndex,u);var i=v?x.fn_D(l[0],l[1]):m.fn_D(l[0],l[1]);M.refillColumn(2,i),a()}}()}}}var i={_min:e._min||[1900,1,31],_max:e._max||[1909,11,11],el:e.el||"packerDateId",submit:e.callback||null},o=i._min,f=n.toLunar(i._min[0],i._min[1],i._min[2]),c=i._max,s=n.toLunar(i._max[0],i._max[1],i._max[2]),v=(i.el,0),d=[{text:"1900",value:1900},{text:"1901",value:1901}],h=[{text:"1",value:1},{text:"2",value:2}],_=[{text:"1",value:1},{text:"2",value:2},{text:"3",value:3}],m={fn_Y:function(){for(var e,n=[],a={},t=c[0],l=o[0]-1,r=l;r<t;r++)e=r+1,a={text:e+"年",value:e},n.push(a);return n},fn_M:function(e){var n=0,a=12;M?(e==c[0]&&(a=c[1]),e==o[0]&&(n=o[1]-1)):n=o[1]-1;for(var t,l=[],r={},u=n;u<a;u++)t=u+1,r={text:t+"月",value:t},l.push(r);return l},fn_D:function(e,n){var a=this.fn_maxD(e,n),t=0;M?(e==c[0]&&n==c[1]&&(a=c[2]),e==o[0]&&n==o[1]&&(t=o[2]-1)):t=o[2]-1,data=[];for(var l,r={},u=t;u<a;u++)l=u+1,r={text:l+"日",value:l},data.push(r);return data},fn_maxD:function(e,n){if("01"==n||"03"==n||"05"==n||"07"==n||"08"==n||"10"==n||"12"==n)return 31;if("04"==n||"06"==n||"09"==n||"11"==n)return 30;if("02"==n){var a=e%4==0,t=e%100!=0,l=e%400==0;return a&&t||l?29:28}}},x={fn_Y:function(){for(var e,n=[],a={},t=s[0],l=f[0]-1,r=l;r<t;r++)e=r+1,a={text:e+"年",value:e},n.push(a);return n},fn_M:function(e){var a=0,t=12;M?(e==c[0]&&(t=c[1]),e==o[0]&&(a=o[1]-1)):a=o[1]-1;for(var l,r=n.leapMonth(e),u=[],i={},f=a,s=a;s<t;s++)f+=1,l=r&&f>r?f-1:f,i={text:l+"月",value:f},u.push(i),r&&f==r&&(f++,i={text:"闰"+l+"月",value:f},u.push(i));return u},fn_D:function(e,n){var a=this.fn_maxD(e,n),t=0;M?(e==c[0]&&n==c[1]&&(a=c[2]),e==o[0]&&n==o[1]&&(t=o[2]-1)):t=o[2]-1;var l=["初一","初二","初三","初四","初五","初六","初七","初八","初九","初十","十一","十二","十三","十四","十五","十六","十七","十八","十九","二十","二一","二二","二三","二四","二五","二六","二七","二八","二九","三十"];data=[];for(var r,u={},i=t;i<a;i++)r=i+1,u={text:l[i],value:r},data.push(u);return data},fn_maxD:function(e,a){var t=n.leapMonth(e);return t&&a>t&&--a,n.lunarMonthDays(e,a)}};a();var M=new Picker({data:[d,h,_],selectedIndex:[0,0,0],title:"选择日期"});document.getElementById(i.el).addEventListener("click",function(){M.show()});var p=o;return M.on("picker.change",function(){l(this)}),M.on("picker.cancel",function(){var e,a=JSON.stringify(this.data),l=t(this.selectedIndex,a);return e=v?n.toSolar(l[0],l[1],l[2]):n.toLunar(l[0],l[1],l[2]),v=!v,this.cancelEl.innerHTML=v?"选择阳历":"选择农历",r(this,function(){u(e,v)}),!1}),M.on("picker.valuechange",function(){var e,a={};v?(a.c={name:"农历",rawData:!0,value:this.selectedVal,leapMonth:n.leapMonth(this.selectedVal[0])},e=n.toSolar(this.selectedVal[0],this.selectedVal[1],this.selectedVal[2]),a.l={name:"阳历",value:e}):(e=n.toLunar(this.selectedVal[0],this.selectedVal[1],this.selectedVal[2]),a.c={name:"农历",value:e,leapMonth:n.leapMonth(e[0])},a.l={name:"阳历",rawData:!0,value:this.selectedVal}),i.submit&&i.submit(a)}),M};window.pickerDate=a}();